(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0c462a"],{"3b38":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-md"},[a("div",{staticClass:"text-center text-h6"},[e._v("CERRAR Y ABRIR RESTAURANTES")]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6"},[a("q-input",{attrs:{filled:"",type:"file",hint:"Selecciona un excel"},on:{input:function(t){e.file=t[0]}}})],1),a("div",{staticClass:"col-6"},[a("q-btn",{attrs:{color:"green"},on:{click:e.readXlsx}},[e._v("Cargar Archivo")])],1)]),a("q-separator",{staticClass:"q-my-md"}),a("div",{staticClass:"row",attrs:{disabled:!e.isEnabled}},[a("div",{staticClass:"col-6"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[a("div",{staticClass:"text-h6"},[e._v("AUTOMATICO")])]),a("div",{staticClass:"col-2 q-mb-sm"},[a("q-input",{attrs:{type:"number",disable:e.active,outlined:"",label:"Tiempo (min.)"},model:{value:e.time_refresh,callback:function(t){e.time_refresh=t},expression:"time_refresh"}})],1),a("div",{staticClass:"col-2 q-mb-sm"},[a("q-input",{attrs:{type:"number",disable:e.active,outlined:"",label:"Min. Pedidos"},model:{value:e.min_pedidos,callback:function(t){e.min_pedidos=t},expression:"min_pedidos"}})],1),a("div",{staticClass:"col-2 q-mb-sm"},[a("q-input",{attrs:{type:"number",disable:e.active,outlined:"",label:"Max. Pedidos"},model:{value:e.max_pedidos,callback:function(t){e.max_pedidos=t},expression:"max_pedidos"}})],1)]),a("div",{staticClass:"row q-pb-md"},[a("div",{staticClass:"col-4"},[a("q-toggle",{attrs:{disable:1==e.isClosing||1==e.isOpening,label:"Activar"},on:{input:e.change_mode},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}})],1),a("div",{staticClass:"col-6"},[a("q-chip",[a("q-avatar",{attrs:{color:"red","text-color":"white"}},[e._v(e._s(e.cantOrdersTotal))]),e._v("Cerrado\n          ")],1),a("q-chip",[a("q-avatar",{attrs:{color:"green","text-color":"white"}},[e._v(e._s(e.cantOrderAssigned))]),e._v("Abierto\n          ")],1)],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6"},[e.isClosing?[a("div",[e._v("\n              CERRANDO...\n              "),a("q-linear-progress",{attrs:{color:"red",indeterminate:""}})],1)]:e._e(),e.isOpening?[a("div",[e._v("\n              ABRIENDO...\n              "),a("q-linear-progress",{attrs:{color:"green",indeterminate:""}})],1)]:e._e()],2)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-11"},[a("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("Historial AUTOMATICO")])]),a("q-card-section",[a("q-scroll-area",{ref:"scrollAreaMenus",staticStyle:{height:"300px","max-width":"100%"}},e._l(e.arrayHistory,(function(t,s){return a("div",{key:s},[e._v("\n                  $ "),a("span",{staticClass:"text-weight-light"},[e._v(e._s(t))])])})),0)],1)],1)],1)])]),a("div",{staticClass:"col-6"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[a("div",{staticClass:"text-h6"},[e._v("MANUALMENTE")])])]),a("div",{staticClass:"row q-pb-md"},[a("div",{staticClass:"col-4"},[e._v("\n          "+e._s(e.texto)+"\n        ")]),a("div",{staticClass:"col-3"},[a("q-btn",{attrs:{color:"green",disable:e.disableBtn},on:{click:function(t){return e.updateMerchant("open")}}},[e._v("Abrir")])],1),a("div",{staticClass:"col-3"},[a("q-btn",{attrs:{color:"red",disable:e.disableBtn},on:{click:function(t){return e.updateMerchant("close")}}},[e._v("Cerrar")])],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-11"},[a("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("Historial")])]),a("q-card-section",[a("q-scroll-area",{ref:"scrollAreaDelivery",staticStyle:{height:"300px","max-width":"100%"}},e._l(e.arrayHistoryDelivery,(function(t,s){return a("div",{key:s},[e._v("\n                  $ "),a("span",{staticClass:"text-weight-light"},[e._v(e._s(t))])])})),0)],1)],1)],1)])])])],1)},r=[],i=a("967e"),n=a.n(i),c=(a("96cf"),a("1146")),l=a.n(c),o=a("c1df"),d=a.n(o),h=[],u={name:"AutoAssign",mounted:function(){this.change_mode()},data:function(){return{file:null,merchantList:[],texto:"",disableBtn:!1,min_pedidos:40,max_pedidos:70,isClosed:!1,isClosing:!1,isOpening:!1,isEnabled:!1,arrayHistory:[],active:!1,cantOrdersTotal:0,cantOrderAssigned:0,refresh_handler:null,time_refresh:5,arrayHistoryDelivery:[]}},methods:{readXlsx:function(){if(this.file){var e=new FileReader;e.onload=function(e){var t=e.target.result,a=l.a.read(t,{type:"binary"}),s=a.Sheets[a.SheetNames[0]],r=l.a.utils.sheet_to_json(s,{header:1});h=r,alert("Se cargaron "+h.length+" valores.")},e.onerror=function(e){console.log(e)},e.readAsBinaryString(this.file),this.isEnabled=!0}else alert("SELECCIONA UN ARCHIVO")},asyncForEach:function(e,t){var a;return n.a.async((function(s){while(1)switch(s.prev=s.next){case 0:a=0;case 1:if(!(a<e.length)){s.next=8;break}return s.next=4,n.a.awrap(t(e[a],a,e));case 4:this.texto=a+1+" de "+e.length;case 5:a++,s.next=1;break;case 8:case"end":return s.stop()}}),null,this)},updateMerchant:function(e){var t,a,s=this;return n.a.async((function(r){while(1)switch(r.prev=r.next){case 0:this.merchantList=h,this.merchantList.length>0?(this.disableBtn=!0,"open"==e?(this.arrayHistoryDelivery.push("Opcion ABRIR Restaurantes ("+d()().format("LTS")+")"),t=function(){return n.a.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.a.awrap(s.asyncForEach(s.merchantList,(function(e){return n.a.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.a.awrap(s.updateHttpMerchant(e[0],1));case 2:case"end":return t.stop()}}))})));case 2:s.arrayHistoryDelivery.push("Se abrio correctamente... ("+d()().format("LTS")+")");case 3:case"end":return e.stop()}}))},t()):(this.arrayHistoryDelivery.push("Opcion CERRAR Restaurantes ("+d()().format("LTS")+")"),a=function(){return n.a.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.a.awrap(s.asyncForEach(s.merchantList,(function(e){return n.a.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.a.awrap(s.updateHttpMerchant(e[0],0));case 2:case"end":return t.stop()}}))})));case 2:s.arrayHistoryDelivery.push("Se cerro correctamente... ("+d()().format("LTS")+")");case 3:case"end":return e.stop()}}))},a())):alert("DEBES CARGAR UN DOCUMENTO");case 2:case"end":return r.stop()}}),null,this)},updateHttpMerchant:function(e,t){var a,s,r;return n.a.async((function(i){while(1)switch(i.prev=i.next){case 0:return a="https://prod-fresh-api.jugnoo.in:4040/update_restaurant_profile",i.prev=1,s=new URLSearchParams,s.append("remarks","Activate"),s.append("restaurant_id",e),s.append("activation_status",t),s.append("user_email","patioservicedelivery@gmail.com"),s.append("token","b3de8bde6886e4695cbf5f23fcc363fa"),i.next=10,n.a.awrap(this.$axios({url:a,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:s}));case 10:r=i.sent,this.arrayHistoryDelivery.push("ID "+e+": "+r.data.message+" ("+d()().format("LTS")+")"),i.next=17;break;case 14:i.prev=14,i.t0=i["catch"](1),console.log("Update Merchant ",i.t0);case 17:this.disableBtn=!1;case 18:case"end":return i.stop()}}),null,this,[[1,14]])},change_mode:function(){this.active?(this.getOrders(),this.arrayHistory.push("Sistema Iniciado ("+d()().format("LTS")+")")):(clearTimeout(this.refresh_handler),this.arrayHistory.push("El Sistema esta DETENIDO ("+d()().format("LTS")+")"))},reset_timer:function(){var e=this;clearTimeout(this.refresh_handler),this.refresh_handler=setTimeout((function(){e.getOrders(),console.log("Refresh MENUS...")}),6e4*this.time_refresh)},getOrders:function(){var e,t,a,s;return n.a.async((function(r){while(1)switch(r.prev=r.next){case 0:if(!this.active){r.next=19;break}return console.log("FINDING ORDERS MENUS..."),this.arrayHistory.push("Obteniendo lista de ordenes MENUS... ("+d()().format("LTS")+")"),e=Date.now(),t=d()().format("YYYY-MM-DD"),a="https://prod-fresh-api.jugnoo.in:4040/admin/get_orders?token=b3de8bde6886e4695cbf5f23fcc363fa&secret=P7JlZXiRiIvSssQSSzqs&city=395&start_date="+t+"&end_date="+t+"&fetch_pending_orders=1&statusCopy=[object%20Object]&status=8&sEcho=1&iColumns=12&sColumns=%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C%2C&iDisplayStart=0&iDisplayLength=500&mDataProp_0=&sSearch_0=&bRegex_0=false&bSearchable_0=true&bSortable_0=true&mDataProp_1=1&sSearch_1=&bRegex_1=false&bSearchable_1=true&bSortable_1=false&mDataProp_2=2&sSearch_2=&bRegex_2=false&bSearchable_2=true&bSortable_2=false&mDataProp_3=3&sSearch_3=&bRegex_3=false&bSearchable_3=true&bSortable_3=false&mDataProp_4=&sSearch_4=&bRegex_4=false&bSearchable_4=true&bSortable_4=false&mDataProp_5=5&sSearch_5=&bRegex_5=false&bSearchable_5=true&bSortable_5=false&mDataProp_6=6&sSearch_6=&bRegex_6=false&bSearchable_6=true&bSortable_6=false&mDataProp_7=7&sSearch_7=&bRegex_7=false&bSearchable_7=true&bSortable_7=false&mDataProp_8=8&sSearch_8=&bRegex_8=false&bSearchable_8=true&bSortable_8=false&mDataProp_9=9&sSearch_9=&bRegex_9=false&bSearchable_9=true&bSortable_9=false&mDataProp_10=10&sSearch_10=&bRegex_10=false&bSearchable_10=true&bSortable_10=false&mDataProp_11=&sSearch_11=&bRegex_11=false&bSearchable_11=true&bSortable_11=false&sSearch=&bRegex=false&iSortCol_0=0&sSortDir_0=desc&iSortingCols=1&_= "+e,r.prev=6,r.next=9,n.a.awrap(this.$axios.get(a));case 9:return s=r.sent,r.next=12,n.a.awrap(this.filterOrderUnasigned(s.data.aaData));case 12:this.cantOrdersTotal=r.sent,this.calcularCantidad(),r.next=19;break;case 16:r.prev=16,r.t0=r["catch"](6),console.log("GET ORDERS MENUS PENDING ERROR: ",r.t0);case 19:this.reset_timer();case 20:case"end":return r.stop()}}),null,this,[[6,16]])},filterOrderUnasigned:function(e){for(var t=0,a=0;a<e.length;a++){var s=e[a][13].status,r=(e[a][13].restaurant_id,e[a][13].order_id,e[a][10],e[9]);0!=s&&"-"==r&&t++}return t},calcularCantidad:function(){this.cantOrdersTotal>this.max_pedidos&&0==this.isClosed?(this.isClosed=!0,this.updateMerchant("close"),this.isclosing=!0,this.active=!1):this.cantOrdersTotal<this.min_pedidos&&1==this.isClosed&&(this.isClosed=!1,this.updateMerchant("open"),this.isOpening=!0,this.active=!1)}}},p=u,_=a("2877"),b=Object(_["a"])(p,s,r,!1,null,null,null);t["default"]=b.exports}}]);