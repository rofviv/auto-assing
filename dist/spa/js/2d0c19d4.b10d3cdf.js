(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0c19d4"],{4794:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"q-pa-md"},[s("q-dialog",{model:{value:e.history,callback:function(t){e.history=t},expression:"history"}},[s("q-card",[s("q-card-section",[e._v("\r\n        Haz click en la orden para visualizarlo en el mapa\r\n      ")]),s("q-card-section",[s("q-list",{attrs:{bordered:"",separator:""}},e._l(e.order_history,(function(t,a){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:""},on:{click:function(s){return e.openWindow(t.order_id)}}},[s("q-item-section",[s("q-item-label",[e._v("Orden ID: "+e._s(t.order_id))]),s("q-item-label",{attrs:{caption:""}},[e._v(e._s(t.details))])],1)],1)})),1)],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1)],1)],1),s("q-dialog",{model:{value:e.dialogFind,callback:function(t){e.dialogFind=t},expression:"dialogFind"}},[s("q-card",[s("q-card-section",[e._v("\r\n        Seleccionar una direccion guardada\r\n      ")]),s("q-card-section",[s("q-list",{attrs:{bordered:"",separator:""}},e._l(e.address_list,(function(t,a){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:""},on:{click:function(t){return e.selectAddress(a)}}},[s("q-item-section",[s("q-item-label",[e._v(e._s(t.name))]),s("q-item-label",{attrs:{caption:""}},[e._v(e._s(t.reference))])],1)],1)})),1)],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK",color:"primary"}})],1)],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:e.dialogSave,callback:function(t){e.dialogSave=t},expression:"dialogSave"}},[s("q-card",{staticStyle:{"min-width":"350px"}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[e._v("Guardar direccion como:")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("q-input",{attrs:{dense:"",autofocus:""},model:{value:e.addressSave,callback:function(t){e.addressSave=t},expression:"addressSave"}})],1),s("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar"}}),s("q-btn",{attrs:{flat:"",label:"Guardar direccion"},on:{click:e.saveAddressLocal}})],1)],1)],1),s("div",{staticClass:"row wrap items-center"},[s("div",{staticClass:"col-7"},[[s("div",{staticClass:"q-py-xs"},[s("q-banner",{class:e.sendOrderMsg.color+" text-white",attrs:{rounded:""}},[e._v("\r\n            ID Orden: "+e._s(e.sendOrderMsg.id)+" "),s("br"),e._v("\r\n            "+e._s(e.sendOrderMsg.msg)+"\r\n          ")])],1)]],2),s("div",{staticClass:"col-5"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-4"},[s("div",{staticClass:"q-gutter-sm text-right"},[s("div",{staticClass:"text-grey-7"},[e._v("Gastos de envío")]),e._v("\r\n            "+e._s(e.deliveryCost)+"\r\n          ")])]),s("div",{staticClass:"col"},[s("div",{staticClass:"q-gutter-sm text-right "},[s("q-btn",{staticClass:"q-mb-sm",attrs:{loading:e.loadDeliveryBtn,color:"primary",size:"10px"},on:{click:e.calculateDelivery}},[e._v("Calcular envío")]),s("q-btn",{staticClass:"q-mb-sm",attrs:{disabled:""==e.details,loading:e.loadBtn,color:"green",size:"10px"},on:{click:e.sendOrder}},[e._v("Finalizar Pedido")]),s("q-btn",{attrs:{flat:"",round:"",icon:"history"},on:{click:function(t){e.history=!0}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"center middle"}},[e._v("\r\n                  Historial\r\n                ")])],1)],1)])])])]),s("q-card",{attrs:{flat:"",bordered:""}},[s("q-card-section",[s("div",{staticClass:"row q-gutter-x-lg no-wrap justify-center q-py-xs"},[s("div",{staticClass:"col-3"},[s("div",{staticClass:"text-center text-grey-6 q-pb-xs"},[e._v("DATOS")]),s("q-card",{attrs:{flat:"",bordered:""}},[s("q-card-section",[s("q-input",{staticClass:"q-pb-xs",attrs:{filled:"",label:"Telefono"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"search"},on:{click:e.findUser}})]},proxy:!0}]),model:{value:e.celClient,callback:function(t){e.celClient=t},expression:"celClient"}}),s("q-input",{staticClass:"q-pb-xs",attrs:{filled:"",label:"Cliente"},model:{value:e.nameClient,callback:function(t){e.nameClient=t},expression:"nameClient"}}),s("q-input",{staticClass:"q-pb-xs",attrs:{filled:"",label:"*Detalle (Obligatorio)",autogrow:""},model:{value:e.details,callback:function(t){e.details=t},expression:"details"}}),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-input",{staticClass:"q-pb-xs",attrs:{filled:"",label:"Razon Social"},model:{value:e.nameNit,callback:function(t){e.nameNit=t},expression:"nameNit"}})],1),s("div",{staticClass:"col"},[s("q-input",{staticClass:"q-pb-xs q-ml-xs",attrs:{filled:"",label:"NIT"},model:{value:e.nit,callback:function(t){e.nit=t},expression:"nit"}})],1)]),s("div",[s("q-input",{attrs:{id:"image",filled:"",type:"file",hint:"Imagen (Opcional)"},on:{input:function(t){e.order_images=t[0]}}})],1),s("div",{staticClass:"q-mt-md"},[s("q-btn",{staticClass:"q-mb-sm",attrs:{loading:e.loadSaveUser,color:"green",size:"10px",icon:"save",label:"Guardar Usuario"},on:{click:e.saveUsers}})],1)],1)],1)],1),s("div",{staticClass:"col-4"},[s("div",{staticClass:"text-center text-grey-6 q-pb-xs"},[e._v("ORIGEN")]),s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col-9"},[s("q-input",{attrs:{filled:"",label:"URL WhatsApp"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"search"},on:{click:function(t){return e.findMap("1")}}})]},proxy:!0}]),model:{value:e.urlWpFrom,callback:function(t){e.urlWpFrom=t},expression:"urlWpFrom"}})],1),s("div",{staticClass:"col-3 q-gutter-sm text-right"},[s("q-btn",{attrs:{flat:"",round:"",icon:"find_in_page"},on:{click:function(t){return e.findAddress("1")}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"center middle"}},[e._v("\r\n                  Buscar dirección guardada\r\n                ")])],1),s("q-btn",{attrs:{flat:"",round:"",icon:"save"},on:{click:function(t){return e.saveAddress("1")}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"center middle"}},[e._v("\r\n                  Guardar esta dirección\r\n                ")])],1)],1)]),s("q-input",{staticClass:"q-pb-xs",attrs:{filled:"",label:"Recoger desde",autogrow:""},model:{value:e.from_address,callback:function(t){e.from_address=t},expression:"from_address"}}),s("q-card",{attrs:{flat:"",bordered:""}},[s("div",{staticStyle:{width:"100%",height:"300px"}},[s("l-map",{ref:"myMapFrom",staticStyle:{"z-index":"0"},attrs:{zoom:e.zoom,center:e.from_center,options:{zoomControl:!1}},on:{click:e.updateMarkerFrom}},[s("l-tile-layer",{attrs:{url:e.url,attribution:e.attribution}}),s("l-marker",{attrs:{"lat-lng":e.from_center}})],1)],1)])],1),s("div",{staticClass:"col-4"},[s("div",{staticClass:"text-center text-grey-6 q-pb-xs"},[e._v("DESTINO")]),s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col-9"},[s("q-input",{attrs:{filled:"",label:"URL WhatsApp"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"search"},on:{click:function(t){return e.findMap("2")}}})]},proxy:!0}]),model:{value:e.urlWpTo,callback:function(t){e.urlWpTo=t},expression:"urlWpTo"}})],1),s("div",{staticClass:"col-3 q-gutter-sm text-right"},[s("q-btn",{attrs:{flat:"",round:"",icon:"find_in_page"},on:{click:function(t){return e.findAddress("2")}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"center middle"}},[e._v("\r\n                  Buscar dirección guardada\r\n                ")])],1),s("q-btn",{attrs:{flat:"",round:"",icon:"save"},on:{click:function(t){return e.saveAddress("2")}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"center middle"}},[e._v("\r\n                  Guardar esta dirección\r\n                ")])],1)],1)]),s("q-input",{staticClass:"q-pb-xs",attrs:{filled:"",label:"Entregar En",autogrow:""},model:{value:e.to_address,callback:function(t){e.to_address=t},expression:"to_address"}}),s("q-card",{attrs:{flat:"",bordered:""}},[s("div",{staticStyle:{width:"100%",height:"300px"}},[s("l-map",{ref:"myMapTo",staticStyle:{"z-index":"0"},attrs:{zoom:e.zoom,center:e.to_center,options:{zoomControl:!1}},on:{click:e.updateMarkerTo}},[s("l-tile-layer",{attrs:{url:e.url,attribution:e.attribution}}),s("l-marker",{attrs:{"lat-lng":e.to_center}})],1)],1)])],1)])])],1)],1)},i=[],r=(s("7f7f"),s("967e")),n=s.n(r),o=(s("96cf"),s("fc1b")),l=(s("c1df"),s("2699")),d=s("a40a"),c=s("4e2b"),p=s("e11eb");s("6cc5"),s("9490");delete p["Icon"].Default.prototype._getIconUrl,p["Icon"].Default.mergeOptions({iconRetinaUrl:s("584d"),iconUrl:s("6397"),shadowUrl:s("e2b9")});var u={components:{"l-map":l["a"],"l-tile-layer":d["a"],"l-marker":c["a"]},data:function(){return{dialogSave:!1,addressSave:"",dialogFind:!1,history:!1,celClient:"",urlWpFrom:"",nameClient:"",urlWpTo:"",order_images:null,details:"",nit:"",nameNit:"",from_address:"",from_center:[-17.783384,-63.18203],to_address:"",to_center:[-17.783384,-63.18203],selectRef:"",selectRefFind:"",address_list:[],deliveryCost:0,sendOrderMsg:{id:-1,color:"bg-white",msg:"No hay pedido realizado",order:{}},loadDeliveryBtn:!1,loadBtn:!1,loadSaveUser:!1,user_identifier:"ff93cd9ec68107",operator_token:"ca3686de8b9cd13abcb362e09e494210",access_token:"0a1374cd2f70caec3f2929ef618563fbe5aa13eb0411d0c28dc73fed0fb3aa0c",zoom:13,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}},mounted:function(){this.getAddress()},methods:{getAddress:function(){var e,t=this;return n.a.async((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,n.a.awrap(o["a"].collection("address").get());case 3:e=s.sent,e.forEach((function(e){t.address_list.push(e.data())})),s.next=10;break;case 7:s.prev=7,s.t0=s["catch"](0),console.log("FIREBASE ERROR ",s.t0);case 10:case"end":return s.stop()}}),null,null,[[0,7]])},openWindow:function(e){window.open("https://patioserviceonline.com/sc/#/map/order/"+e)},updateMarkerFrom:function(e){this.from_center=[e.latlng.lat,e.latlng.lng]},updateMarkerTo:function(e){this.to_center=[e.latlng.lat,e.latlng.lng]},findMap:function(e){if("1"==e){var t="https://maps.google.com/maps?q=";if(0==this.urlWpFrom.indexOf(t)){var s="%2C",a="&z=17&hl=es",i=this.urlWpFrom.substring(t.length,this.urlWpFrom.indexOf(s)),r=this.urlWpFrom.substring(this.urlWpFrom.indexOf(s)+s.length,this.urlWpFrom.indexOf(a));this.from_center=[parseFloat(i),parseFloat(r)]}else alert("URL del mapa es invalido")}else{t="https://maps.google.com/maps?q=";if(0==this.urlWpTo.indexOf(t)){s="%2C",a="&z=17&hl=es",i=this.urlWpTo.substring(t.length,this.urlWpTo.indexOf(s)),r=this.urlWpTo.substring(this.urlWpTo.indexOf(s)+s.length,this.urlWpTo.indexOf(a));this.to_center=[parseFloat(i),parseFloat(r)]}else alert("URL del mapa es invalido")}},calculateDelivery:function(){var e,t;return n.a.async((function(s){while(1)switch(s.prev=s.next){case 0:return this.deliveryCost=0,this.loadDeliveryBtn=!0,e="https://prod-fatafat-new.jugnoo.in:4030/get_all_details?device_type=0&app_version=436&to_latitude="+JSON.stringify(this.to_center[0])+"&access_token="+this.access_token+"&login_type=0&from_latitude="+JSON.stringify(this.from_center[0])+"&locale=es&operator_token="+this.operator_token+"&to_longitude="+JSON.stringify(this.to_center[1])+"&customer_package_name=com.movapps.mav.patioservice&from_longitude="+JSON.stringify(this.from_center[1]),s.prev=3,s.next=6,n.a.awrap(this.$axios.get(e));case 6:t=s.sent,t.data.delivery_charges?this.deliveryCost=t.data.delivery_charges.estimated_charges:alert(t.data.message),s.next=13;break;case 10:s.prev=10,s.t0=s["catch"](3),console.log("Error al calcular el costo de envio: ",s.t0);case 13:this.loadDeliveryBtn=!1;case 14:case"end":return s.stop()}}),null,this,[[3,10]])},sendOrder:function(){var e,t,s,a;return n.a.async((function(i){while(1)switch(i.prev=i.next){case 0:return this.loadBtn=!0,e="https://prod-fatafat-new.jugnoo.in:4030/place_order",t="",s=new URLSearchParams,this.order_images&&s.append("order_images",this.order_images),""!=this.celClient&&(t+="*CEL: "+this.celClient+" "),""!=this.nameClient&&(t+="*CLI: "+this.nameClient+" "),""==this.nameNit&&""==this.nit||(t+="*NIT: "+this.nit+" - "+this.nameNit+" "),t+="DET: "+this.details,s.append("details",t),s.append("from_address",this.from_address),s.append("from_latitude",JSON.stringify(this.from_center[0])),s.append("from_longitude",JSON.stringify(this.from_center[1])),s.append("payment_mode","1"),s.append("to_address",this.to_address),s.append("to_latitude",JSON.stringify(this.to_center[0])),s.append("to_longitude",JSON.stringify(this.to_center[1])),s.append("is_immediate","1"),s.append("user_identifier",this.user_identifier),s.append("app_version","436"),s.append("device_type","0"),s.append("login_type","0"),s.append("operator_token",this.operator_token),s.append("customer_package_name","com.movapps.mav.patioservice"),s.append("locale","es"),s.append("access_token",this.access_token),i.prev=26,i.next=29,n.a.awrap(this.$axios.post(e,s));case 29:a=i.sent,a.data.order_id?(this.sendOrderMsg.id=a.data.order_id,this.sendOrderMsg.msg=a.data.message,this.sendOrderMsg.color="bg-green-5",this.$store.commit("orderHistory/updateHistory",{order_id:a.data.order_id,details:this.details}),this.clearInputs()):(this.sendOrderMsg.id="ERROR",this.sendOrderMsg.msg=a.data.message,this.sendOrderMsg.color="bg-red-5"),i.next=36;break;case 33:i.prev=33,i.t0=i["catch"](26),console.log("Error SEND ORDER",i.t0);case 36:this.loadBtn=!1;case 37:case"end":return i.stop()}}),null,this,[[26,33]])},findAddress:function(e){this.selectRefFind=e,this.dialogFind=!0},selectAddress:function(e){"1"==this.selectRefFind?(this.from_address=this.address_list[e].reference,this.from_center=[this.address_list[e].latlng.latitude,this.address_list[e].latlng.longitude]):(this.to_address=this.address_list[e].reference,this.to_center=[this.address_list[e].latlng.latitude,this.address_list[e].latlng.longitude]),this.dialogFind=!1},saveAddressLocal:function(){var e,t;return n.a.async((function(s){while(1)switch(s.prev=s.next){case 0:if(this.$q.loading.show(),e={},"1"!=this.selectRef){s.next=6;break}e={name:this.addressSave,reference:this.from_address,latlng:{latitude:this.from_center[0],longitude:this.from_center[1]}},s.next=11;break;case 6:if("2"!=this.selectRef){s.next=10;break}e={name:this.addressSave,reference:this.to_address,latlng:{latitude:this.to_center[0],longitude:this.to_center[1]}},s.next=11;break;case 10:return s.abrupt("return");case 11:return s.prev=11,s.next=14,n.a.awrap(o["a"].collection("address").add(e));case 14:t=s.sent,t.id&&(this.address_list.push(e),this.dialogSave=!1,this.addressSave=""),s.next=21;break;case 18:s.prev=18,s.t0=s["catch"](11),console.log("ERROR SAVE ADDRESS ",s.t0);case 21:this.$q.loading.hide();case 22:case"end":return s.stop()}}),null,this,[[11,18]])},saveAddress:function(e){this.selectRef=e,"1"==e?""!=this.from_address&&(this.dialogSave=!0):""!=this.to_address&&(this.dialogSave=!0)},clearInputs:function(){this.details="",this.order_images=null,this.from_address="",this.to_address="",this.urlWpFrom="",this.urlWpTo="",this.celClient="",this.nameClient=""},findUser:function(){var e,t;return n.a.async((function(s){while(1)switch(s.prev=s.next){case 0:if(this.$q.loading.show(),""==this.celClient){s.next=15;break}return s.prev=2,s.next=5,n.a.awrap(o["a"].collection("users").doc(this.celClient));case 5:return e=s.sent,s.next=8,n.a.awrap(e.get());case 8:t=s.sent,t.exists?(this.nameClient=t.data().name,this.nit=t.data().nit,this.nameNit=t.data().nameNit,this.to_address=t.data().address,this.to_center=[t.data().coords.latitude,t.data().coords.longitude],this.$q.notify({message:"Datos Cargados",icon:"check",color:"green",position:"top",timeout:1e3})):this.$q.notify({message:"No existe el usuario",icon:"close",color:"negative",position:"top",timeout:1e3}),s.next=15;break;case 12:s.prev=12,s.t0=s["catch"](2),console.log("FIREBASE ERROR ",s.t0);case 15:this.$q.loading.hide();case 16:case"end":return s.stop()}}),null,this,[[2,12]])},saveUsers:function(){return n.a.async((function(e){while(1)switch(e.prev=e.next){case 0:if(""==this.nameClient||""==this.to_address||""==this.celClient){e.next=14;break}return this.loadSaveUser=!0,e.prev=2,e.next=5,n.a.awrap(o["a"].collection("users").doc(this.celClient).set({name:this.nameClient,nit:this.nit,nameNit:this.nameNit,address:this.to_address,coords:{latitude:this.to_center[0],longitude:this.to_center[1]}}));case 5:this.$q.notify({message:"Usuario Guardado",icon:"check",color:"green",position:"top",timeout:1e3}),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](2),console.log("FIREBASE ERROR SAVE ",e.t0);case 11:this.loadSaveUser=!1,e.next=15;break;case 14:alert("Los campos: Cliente, Telefono y direccion de entrega No pueden estar vacios");case 15:case"end":return e.stop()}}),null,this,[[2,8]])}},computed:{order_history:{get:function(){return this.$store.getters["orderHistory/getHistory"]}}}},h=u,m=s("2877"),f=Object(m["a"])(h,a,i,!1,null,null,null);t["default"]=f.exports}}]);